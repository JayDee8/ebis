@model IEnumerable<ebis.Models.akce_naklady>

@{
    var grid = new WebGrid(Model, ajaxUpdateContainerId: "financeDiv", canPage: false, canSort: true);
   
    IEnumerable<WebGridColumn> cols =
            new List<WebGridColumn> {
                new WebGridColumn{
                    CanSort=true,
                    Header="Druh",
                    Format = @<text> 
                                <input type="hidden" id="inId_@item.naklady.pk_id" value="@item.naklady.pk_id" />
                                <label id="inNaklad_@item.naklady.pk_id" >@item.naklady.jmeno</label>
                                </text>
                },
                new WebGridColumn{
                    Header="Cena", 
                    Format = @<text> 
                                <input type="number" id="inCena_@item.naklady.pk_id" value="@item.cena" placeholder="cena" onfocus="saveCena(this);" onchange="reSum(this);" />
                                </text>
                }
                /*,
                new WebGridColumn{
                    Format = @<text>
                                <a href="javascript:void(0);" title="uložit tento řádek" class="glyphicon glyphicon-edit" onclick="javascript:quickUpdateAcc(this)"></a>&nbsp;
                                <a href="javascript:void(0);" title="vymazat tento řádek" class="glyphicon glyphicon-remove" onclick="javascript:quickRemoveAcc(this)"></a>
                            </text>
                }*/
            };


           
}

@grid.GetHtml(columns: cols, tableStyle: "table table-striped table-hover interpret-rows", htmlAttributes: new { id = "financeGrid" })


<script type="text/javascript">
    //---- pro zobrazení v debuggeru, šikovné
    //# sourceURL=_accommodationGrid.cshtml

    var sCena = 0;
    function saveCena(item) {
        sCena = item.value;
    }
    function reSum(item) {
       // $("#sumCena1")[0].innerHTML = parseFloat($("#sumCena1")[0].innerHTML) - parseFloat(sCena1) + parseFloat(item.value);
       // $("#sumAll")[0].innerHTML = parseFloat($("#sumCena1")[0].innerHTML) + parseFloat($("#sumCena2")[0].innerHTML) + parseFloat($("#sumCena3")[0].innerHTML)
        //item.parentElement.parentElement.querySelector("label[id*='inCenaSum_']").innerHTML = parseFloat(item.parentElement.parentElement.querySelector("label[id*='inCenaSum_']").innerHTML) - parseFloat(sCena1) + parseFloat(item.value);
        sCena = item.value;
        quickUpdateFin(item);
    }


    function quickUpdateFin(element) {
        var naklady_id = element.parentNode.parentNode.querySelector("input[id^='inId']").value;
        var cena = element.parentNode.parentNode.querySelector("input[id^='inCena']").value;
        var isSuccess = -1;
            
        var Finance =
        {
            "naklady_id": naklady_id,
            "akce_id": @ViewBag.idAkce,
            "cena": cena
        };

        $.ajax({
            url: '/FinanceItem/QuickUpdate/',
            data: JSON.stringify(Finance),
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            success: function (result) {
                isSuccess = result[0];
            },
            error: function (result) {
                isSuccess = result[0];
            }

        }).done(function () {
            if (isSuccess == "1") {           // Successfully saved

                window.setTimeout(function () {
                    addAlert("Úspěšně uloženo...","alert-success");
                }, 1);

            }
            else {                      // Data Error
                window.setTimeout(function () {
                    addAlert("Chyba, zkontrolujte databázi a kontaktujte správce...","alert-danger");
                }, 1);
            }
            return false;
        });
    }
</script>

